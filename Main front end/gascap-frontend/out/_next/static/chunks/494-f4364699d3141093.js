"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[494],{4730:(e,t,a)=>{a.d(t,{Gb:()=>d,Qu:()=>x,vT:()=>o});var r=a(2115),s=a(1012),n=a(6836),l=a(8678),i=a(6830),c=a(8884);function o(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{if(!window.ethereum)return void alert("Please install MetaMask to use this application.");try{let e=new s.k(window.ethereum);await e.send("eth_requestAccounts",[]);let a=await e.getNetwork();if(Number(a.chainId)!==i.PI.CHAIN_ID){try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+i.PI.CHAIN_ID.toString(16)}]})}catch(e){4902===e.code&&await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x"+i.PI.CHAIN_ID.toString(16),chainName:"Flare Coston2 Testnet",nativeCurrency:{name:"Coston2 Flare",symbol:"C2FLR",decimals:18},rpcUrls:[i.PI.RPC_URL],blockExplorerUrls:[i.PI.EXPLORER_URL]}]})}let e=new s.k(window.ethereum),a=await e.send("eth_requestAccounts",[]),r=await e.getNetwork();t(a[0]),n(e),c(Number(r.chainId))}else{let r=await e.send("eth_requestAccounts",[]);t(r[0]),n(e),c(Number(a.chainId))}}catch(e){console.error("Wallet connection failed",e)}},[]);return(0,r.useEffect)(()=>{if(window.ethereum){let e=e=>t(e[0]||null),a=()=>window.location.reload();return window.ethereum.on("accountsChanged",e),window.ethereum.on("chainChanged",a),window.ethereum.request({method:"eth_accounts"}).then(e=>{e.length>0&&o()}).catch(()=>{}),()=>{window.ethereum.removeListener("accountsChanged",e),window.ethereum.removeListener("chainChanged",a)}}},[o]),{address:e,provider:a,chainId:l,connect:o}}function d(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),c=(0,r.useCallback)(async()=>{try{let e=new n.FR(i.PI.RPC_URL),a=new l.NZ(i.PI.FACTORY_ADDRESS,i.QJ,e),r=await a.getAllMarkets(),s=await Promise.all(r.map(async t=>{try{let a=new l.NZ(t,i.pQ,e),r=await a.getMarketInfo();return{address:t,name:r[0],strike:BigInt(r[2]),expiry:BigInt(r[3]),isSettled:r[4],participants:BigInt(r[5])}}catch(a){try{let a=new l.NZ(t,i.pQ,e),[r,s,n]=await Promise.all([a.marketName().catch(()=>"Unknown"),a.strikePrice().catch(()=>0n),a.expiryTimestamp().catch(()=>0n)]);return{address:t,name:r,strike:BigInt(s),expiry:BigInt(n),isSettled:!1,participants:0n}}catch(e){return{address:t,name:"Unknown Market",strike:0n,expiry:0n,isSettled:!1,participants:0n}}}}));t(s)}catch(e){console.warn("Factory fetch failed:",e)}finally{s(!1)}},[]);return(0,r.useEffect)(()=>{c();let e=setInterval(c,3e4);return()=>clearInterval(e)},[c]),{markets:e,loading:a,refresh:c}}function x(e,t){let a=t||i.PI.CONTRACT_ADDRESS,[s,o]=(0,r.useState)(null),[d,x]=(0,r.useState)(null),[m,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(0n),[f,g]=(0,r.useState)([]),[w,N]=(0,r.useState)(!0),[b,j]=(0,r.useState)(null),v=(0,r.useRef)(0);(0,r.useEffect)(()=>{o(null),x(null),u(null),p(0n),g([]),N(!0),j(null),v.current=0},[a]);let S=(0,r.useCallback)(async()=>{try{let r=new n.FR(i.PI.RPC_URL),s=new l.NZ(a,i.pQ,r),[d,m,h]=await Promise.allSettled([s.getContractState(),s.getCurrentGasPriceView().catch(()=>s.getCurrentGasPrice()),(0,c.Js)(["BTC/USD","ETH/USD","FLR/USD"])]);if("fulfilled"===d.status&&d.value){let e=d.value;o({strikePriceGwei:BigInt(e[0]),expiryTimestamp:BigInt(e[1]),isSettled:e[2],settlementPriceGwei:BigInt(e[3]),totalLiquidityWei:BigInt(e[4]),participantCount:BigInt(e[5])}),j(null)}else if("rejected"===d.status){var t;console.warn("getContractState failed:",null==(t=d.reason)?void 0:t.message),j("Contract not responding. Check if correct address is deployed.")}let f=!1;if("fulfilled"===h.status&&h.value){let e=h.value,t=e.find(e=>"BTC/USD"===e.feedName),a=e.find(e=>"ETH/USD"===e.feedName),r=e.find(e=>"FLR/USD"===e.feedName);if(t&&a&&r){let e=Math.floor(t.value),s=Math.floor(a.value),n=Math.floor(1e4*r.value),l=e%100,i=s%100,c=n%100,o=Math.max(1,Math.floor((50*l+30*i+20*c)/100)),d=t.timestamp||Math.floor(Date.now()/1e3);console.log("FTSO Direct → BTC=$".concat(e," (").concat(l,") ETH=$").concat(s," (").concat(i,") FLR=").concat(n," (").concat(c,") → Index=").concat(o)),x({price:BigInt(o),timestamp:BigInt(d)}),f=!0}}if(!f&&"fulfilled"===m.status&&m.value){let e=BigInt(m.value[0]);console.log("RAW GAS PRICE FROM CONTRACT:",e.toString());let t=function(e){let t=Number(e);return t<=0?35n:t>=1&&t<=99?e:t>=100?BigInt(Math.max(1,t%100)):e}(e);x({price:t,timestamp:BigInt(m.value[1])})}try{let e=await r.getBlockNumber();0===v.current&&(v.current=Math.max(0,e-5e4));let t=s.filters.FuturesMinted(),a=await s.queryFilter(t,v.current,e);if(a.length>0){let t=await Promise.all(a.slice(-20).map(async e=>{let t=await e.getBlock();return{trader:e.args[0],isLong:e.args[1],quantity:BigInt(e.args[2]),collateral:BigInt(e.args[3]),leverage:BigInt(e.args[4]),timestamp:t.timestamp,txHash:e.transactionHash}}));g(e=>[...t,...e].filter((e,t,a)=>a.findIndex(t=>t.txHash===e.txHash)===t).sort((e,t)=>t.timestamp-e.timestamp).slice(0,50)),v.current=e}}catch(e){console.warn("Event fetch failed (non-critical):",e)}if(e){let[t,a]=await Promise.allSettled([s.getPosition(e),s.liquidityProvided(e)]);if("fulfilled"===t.status&&t.value){let e=t.value;u({exists:e[0],isLong:e[1],quantity:BigInt(e[2]),collateralWei:BigInt(e[3]),leverage:BigInt(e[4]),marginMode:Number(e[5]),entryType:Number(e[6]),entryPrice:BigInt(e[7]),openTimestamp:BigInt(e[8]),isActive:e[9],isClaimed:e[10],notionalValue:BigInt(e[11]),margin:BigInt(e[12])})}"fulfilled"===a.status&&p(BigInt(a.value))}}catch(e){console.warn("Contract fetch error:",null==e?void 0:e.message),j((null==e?void 0:e.message)||"Failed to connect to contract")}finally{N(!1)}},[e,a]);return(0,r.useEffect)(()=>{S();let e=setInterval(S,i.PI.POLL_INTERVAL_MS);return()=>clearInterval(e)},[S]),{contractState:s,currentGasPrice:d,userPosition:m,userLiquidity:h,recentTrades:f,loading:w,connectionError:b,refresh:S}}},7965:(e,t,a)=>{a.d(t,{Y:()=>y});var r=a(5155),s=a(3998),n=a(1647),l=a(1480),i=a(1851),c=a(2593),o=a(8770),d=a(6874),x=a(9784),m=a(1064),u=a(5666),h=a(9201),p=a(4972),f=a(6767),g=a(2619),w=a.n(g),N=a(2115),b=a(9007),j=a(212),v=a(6943),S=a(4269),I=a(6830);function C(e){let{markets:t,selectedAddress:a,onSelect:l,loading:o}=e,[d,x]=(0,N.useState)(!1),m=(0,N.useRef)(null);(0,N.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&x(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let u=t.find(e=>e.address.toLowerCase()===a.toLowerCase()),h=Math.floor(Date.now()/1e3),p=[],f=new Set,g=I.PI.CONTRACT_ADDRESS.toLowerCase();return t.some(e=>e.address.toLowerCase()===g)||(p.push({address:I.PI.CONTRACT_ADDRESS,name:"GasCap Default",strike:0n,expiry:0n,isSettled:!1,participants:0n}),f.add(g)),t.forEach(e=>{let t=e.address.toLowerCase();f.has(t)||(p.push(e),f.add(t))}),(0,r.jsxs)("div",{ref:m,className:"relative",children:[(0,r.jsxs)(s.$,{variant:"outline",size:"sm",onClick:()=>x(!d),className:"border-white/10 bg-white/5 hover:bg-white/10 font-code text-[10px] h-8 px-3 gap-1.5 rounded-sm",children:[(0,r.jsx)(i.A,{className:"w-3 h-3 text-primary"}),u?(0,r.jsx)("span",{className:"max-w-[120px] truncate",children:u.name}):(0,r.jsx)("span",{children:"Select Market"}),(0,r.jsx)(b.A,{className:(0,S.cn)("w-3 h-3 transition-transform",d&&"rotate-180")}),p.length>0&&(0,r.jsx)(n.E,{className:"text-[7px] h-3 px-1 bg-primary/20 text-primary border-none ml-1",children:p.length})]}),d&&(0,r.jsx)("div",{className:"absolute top-full left-0 mt-1 w-[280px] bg-[#0c0c0c] border border-white/10 rounded-sm shadow-2xl z-[100] max-h-[300px] overflow-y-auto",children:o?(0,r.jsx)("div",{className:"p-4 text-center text-[10px] text-muted-foreground",children:"Loading markets..."}):0===p.length?(0,r.jsx)("div",{className:"p-4 text-center text-[10px] text-muted-foreground",children:"No markets found"}):p.map(e=>{let t=e.address.toLowerCase()===a.toLowerCase(),s=Number(e.expiry)>0&&Number(e.expiry)<=h;return(0,r.jsxs)("button",{onClick:()=>{l(e.address),x(!1)},className:(0,S.cn)("w-full text-left px-3 py-2.5 border-b border-white/5 last:border-b-0 hover:bg-white/5 transition-colors",t&&"bg-primary/10 border-l-2 border-l-primary"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("span",{className:"text-[11px] font-bold text-white truncate max-w-[160px]",children:e.name||"Unnamed"}),e.isSettled?(0,r.jsx)(n.E,{className:"text-[7px] h-3 px-1 bg-emerald-500/20 text-emerald-400 border-none",children:"SETTLED"}):s?(0,r.jsx)(n.E,{className:"text-[7px] h-3 px-1 bg-red-500/20 text-red-400 border-none",children:"EXPIRED"}):(0,r.jsx)(n.E,{className:"text-[7px] h-3 px-1 bg-blue-500/20 text-blue-400 border-none",children:"LIVE"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-[9px] text-muted-foreground",children:[(0,r.jsxs)("span",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(j.A,{className:"w-2.5 h-2.5"}),"Strike: ",e.strike>0n?e.strike.toString():"?"]}),(0,r.jsxs)("span",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(c.A,{className:"w-2.5 h-2.5"}),e.expiry>0n?(e=>{let t=Number(e)-h;if(t<=0)return"EXPIRED";let a=Math.floor(t/3600),r=Math.floor(t%3600/60);return"".concat(a,"h ").concat(r,"m")})(e.expiry):"--"]}),(0,r.jsxs)("span",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(v.A,{className:"w-2.5 h-2.5"}),e.participants.toString()]})]}),(0,r.jsxs)("div",{className:"text-[8px] text-muted-foreground/40 mt-0.5 font-code",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]},e.address)})})]})}function y(e){let{address:t,gasPrice:a,state:g,onConnect:N,connectionError:b,markets:j=[],selectedMarket:v="",onSelectMarket:S,marketsLoading:I}=e,y=a?Number(a.price):0,k=g?Number(g.strikePriceGwei):0,E=!!g&&Number(g.expiryTimestamp)<=Math.floor(Date.now()/1e3);return(0,r.jsxs)("header",{className:"h-16 bg-[#0a0a0a]/90 border-b border-white/5 flex items-center px-4 justify-between shrink-0 z-50 backdrop-blur-md sticky top-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 pr-6 border-r border-white/10",children:[(0,r.jsx)("div",{className:"p-2 bg-gradient-to-tr from-orange-500 to-red-600 rounded-lg shadow-[0_0_15px_rgba(239,68,68,0.4)]",children:(0,r.jsx)(l.A,{size:20,className:"text-white fill-white/20"})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("h1",{className:"font-bold text-lg tracking-tight text-white leading-none uppercase",children:"GASCAP"}),(0,r.jsx)(n.E,{className:"text-[7px] h-3.5 px-1 bg-amber-500/15 text-amber-400 border-amber-500/20 font-black uppercase tracking-wider",children:"Futures"})]}),(0,r.jsx)("span",{className:"text-[10px] text-primary font-bold uppercase tracking-widest leading-none mt-1",children:"Gas Futures Exchange"})]})]}),S&&(0,r.jsx)("div",{className:"hidden md:block pr-6 border-r border-white/10",children:(0,r.jsx)(C,{markets:j,selectedAddress:v,onSelect:S,loading:I})}),(0,r.jsxs)("div",{className:"hidden xl:flex items-center gap-10 font-code",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase flex items-center gap-1 mb-0.5",children:[(0,r.jsx)(i.A,{size:10,className:y>0?"text-emerald-500":"text-red-500"}),y>0?"FTSO Gas Index":"Awaiting FTSO Feed"]}),(0,r.jsxs)("span",{className:"text-lg font-bold leading-none ".concat(y>0?"text-emerald-400 drop-shadow-[0_0_8px_rgba(52,211,153,0.5)]":"text-muted-foreground"),children:[y>0?y.toFixed(2):"---"," ",(0,r.jsx)("span",{className:"text-[10px] text-emerald-600 font-normal uppercase",children:"Index"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase mb-0.5",children:"Strike Price"}),(0,r.jsxs)("span",{className:"text-white font-medium text-sm leading-none",children:[k>0?k.toString():"---"," ",(0,r.jsx)("span",{className:"text-[10px] text-muted-foreground uppercase",children:"Index"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase mb-0.5",children:"Pool Liquidity"}),(0,r.jsxs)("span",{className:"text-white font-medium text-sm leading-none",children:[g?(Number(g.totalLiquidityWei)/1e18).toFixed(4):"---"," ",(0,r.jsx)("span",{className:"text-[10px] text-muted-foreground uppercase",children:"C2FLR"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase mb-0.5 flex items-center gap-1",children:[(0,r.jsx)(c.A,{size:10})," ",(null==g?void 0:g.isSettled)?"Settled":"Expiry"]}),(0,r.jsx)("div",{className:"flex items-center gap-2 text-xs font-bold leading-none",children:(0,r.jsx)("span",{className:(null==g?void 0:g.isSettled)?"text-emerald-400":E?"text-red-400":"text-orange-400",children:(null==g?void 0:g.isSettled)?"SETTLED":(()=>{if(!g)return"--:--:--";let e=Math.floor(Date.now()/1e3),t=Number(g.expiryTimestamp)-e;if(t<=0)return"EXPIRED";let a=Math.floor(t/3600),r=Math.floor(t%3600/60);return"".concat(a.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))})()})}),g&&!g.isSettled&&(0,r.jsx)("span",{className:"text-[8px] text-muted-foreground/50 mt-0.5",children:g?new Date(1e3*Number(g.expiryTimestamp)).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"UTC"})+" UTC":""})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[b&&(0,r.jsx)(f.Bc,{children:(0,r.jsxs)(f.m_,{children:[(0,r.jsx)(f.k$,{children:(0,r.jsx)(o.A,{className:"w-4 h-4 text-red-400 animate-pulse"})}),(0,r.jsx)(f.ZI,{className:"bg-red-900/90 border-red-500/30 text-red-100 text-[10px] max-w-[250px]",children:b})]})}),(0,r.jsxs)("nav",{className:"hidden lg:flex items-center gap-4 mr-6",children:[(0,r.jsxs)(w(),{href:"/",className:"text-[10px] font-bold text-primary/70 hover:text-primary flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,r.jsx)(l.A,{className:"w-3.5 h-3.5"})," Futures"]}),(0,r.jsxs)(w(),{href:"/liquidity",className:"text-[10px] font-bold text-muted-foreground hover:text-primary flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,r.jsx)(d.A,{className:"w-3.5 h-3.5"})," Pool"]}),(0,r.jsxs)(w(),{href:"/settle",className:"text-[10px] font-bold text-muted-foreground hover:text-primary flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,r.jsx)(x.A,{className:"w-3.5 h-3.5"})," Settle"]}),(0,r.jsxs)(w(),{href:"/depeg",className:"text-[10px] font-bold text-indigo-400/70 hover:text-indigo-400 flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,r.jsx)(m.A,{className:"w-3.5 h-3.5"})," Depeg"]}),(0,r.jsxs)(w(),{href:"/explore",className:"text-[10px] font-bold text-violet-400/70 hover:text-violet-400 flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,r.jsx)(u.A,{className:"w-3.5 h-3.5"})," Explore"]})]}),(0,r.jsxs)("div",{className:"hidden lg:flex items-center gap-2 px-3 py-1.5 bg-blue-500/10 border border-blue-500/20 rounded-full text-[10px] text-blue-400 font-bold uppercase tracking-tight",children:[(0,r.jsx)(h.A,{className:"w-3.5 h-3.5"})," Coston2"]}),(0,r.jsx)(s.$,{variant:"outline",size:"sm",onClick:N,className:"border-white/10 bg-white/5 hover:bg-white/10 font-code text-[11px] h-9 px-4 gap-2 rounded-sm transition-all",children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),t.slice(0,4),"...",t.slice(-4)]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.A,{className:"w-4 h-4"})," CONNECT"]})})]})]})}}}]);